# Project#2_Andreeva_M25-555

Консольное приложение для работы с базой данных с поддержкой CRUD-операций, декораторов и кэширования.

## Установка

Для установки проекта используйте Poetry:

```bash
make install
```

или

```bash
poetry install
```

## Запуск

Для запуска приложения используйте:

```bash
make run
```

или

```bash
poetry run database
```

или

```bash
make database
```

## Управление таблицами

### Команды

- `create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> ...` - создать таблицу
- `list_tables` - показать список всех таблиц
- `drop_table <имя_таблицы>` - удалить таблицу
- `help` - справочная информация
- `exit` - выход из программы

### Поддерживаемые типы данных

- `int` - целое число
- `str` - строка
- `bool` - логическое значение

### Пример использования

```bash
>>> database

***База данных***

***Процесс работы с таблицей***

Функции:
<command> create_table <имя_таблицы> <столбец1:тип> .. - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

>>>Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

>>>Введите команду: list_tables
- users

>>>Введите команду: drop_table users
Таблица "users" успешно удалена
```

### Примечания

- Столбец `ID:int` автоматически добавляется в начало каждой таблицы как уникальный ключ
- Метаданные таблиц сохраняются в файл `db_meta.json`
- При создании таблицы с уже существующим именем будет выведена ошибка
- При удалении несуществующей таблицы будет выведена ошибка

## CRUD-операции

### Команды

- `insert into <имя_таблицы> values (<значение1>, <значение2>, ...)` - создать запись
- `select from <имя_таблицы>` - прочитать все записи
- `select from <имя_таблицы> where <столбец> = <значение>` - прочитать записи по условию
- `update <имя_таблицы> set <столбец1> = <новое_значение1> where <столбец_условия> = <значение_условия>` - обновить запись
- `delete from <имя_таблицы> where <столбец> = <значение>` - удалить запись
- `info <имя_таблицы>` - вывести информацию о таблице

### Пример использования

```bash
>>> database

***Операции с данными***

Функции:
<command> insert into <имя_таблицы> values (<значение1>, <значение2>, ...) - создать запись.
<command> select from <имя_таблицы> where <столбец> = <значение> - прочитать записи по условию.
<command> select from <имя_таблицы> - прочитать все записи.
<command> update <имя_таблицы> set <столбец1> = <новое_значение1> where <столбец_условия> = <значение_условия> - обновить запись.
<command> delete from <имя_таблицы> where <столбец> = <значение> - удалить запись.
<command> info <имя_таблицы> - вывести информацию о таблице.

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

>>> Введите команду: insert into users values ("Sergei", 28, true)
Запись с ID=1 успешно добавлена в таблицу "users".

>>> Введите команду: select from users where age = 28
+----+--------+-----+-----------+
| ID |  name  | age | is_active |
+----+--------+-----+-----------+
| 1  | Sergei | 28  |    True   |
+----+--------+-----+-----------+

>>> Введите команду: update users set age = 29 where name = "Sergei"
Запись с ID=1 в таблице "users" успешно обновлена.

>>> Введите команду: delete from users where ID = 1
Запись с ID=1 успешно удалена из таблицы "users".

>>> Введите команду: info users
Таблица: users
Столбцы: ID:int, name:str, age:int, is_active:bool
Количество записей: 0
```

### Примечания

- При команде `insert` не нужно указывать значение для столбца `ID` - он генерируется автоматически
- Строковые значения должны быть заключены в кавычки (одинарные или двойные)
- Булевы значения: `true` или `false`
- Данные каждой таблицы хранятся в отдельном файле `data/<имя_таблицы>.json`
- Результаты `select` выводятся в красивом табличном формате с помощью библиотеки PrettyTable

## Декораторы и улучшения качества кода

Проект использует декораторы Python для улучшения качества кода, обработки ошибок и повышения удобства использования.

### Обработка ошибок

Все операции с базой данных защищены декоратором `@handle_db_errors`, который автоматически обрабатывает:

- `FileNotFoundError` - отсутствие файлов данных
- `KeyError` - обращение к несуществующим таблицам или столбцам
- `ValueError` - ошибки валидации данных
- Другие неожиданные ошибки

### Подтверждение опасных операций

Операции удаления защищены декоратором `@confirm_action`, который запрашивает подтверждение перед выполнением:

- `drop_table` - удаление таблицы
- `delete` - удаление записей

Пример:

```bash
>>> Введите команду: drop_table users
Вы уверены, что хотите выполнить "удаление таблицы"? [y/n]: n
Операция отменена.
```

### Измерение времени выполнения

Операции, работающие с файлами, используют декоратор `@log_time` для измерения времени выполнения:

- `insert` - добавление записей
- `select` - выборка записей

Пример вывода:

```
Функция insert выполнилась за 0.023 секунд.
Функция select выполнилась за 0.015 секунд.
```

### Кэширование результатов

Операция `select` использует кэширование для оптимизации повторяющихся запросов. Результаты одинаковых запросов кэшируются и возвращаются из кэша без повторного выполнения операции.

### Преимущества использования декораторов

- **Централизованная обработка ошибок** - вся логика обработки ошибок находится в одном месте
- **Безопасность** - опасные операции требуют подтверждения
- **Производительность** - кэширование ускоряет повторяющиеся запросы
- **Мониторинг** - измерение времени выполнения помогает выявить узкие места
- **Чистый код** - декораторы позволяют отделить основную логику от вспомогательной функциональности
